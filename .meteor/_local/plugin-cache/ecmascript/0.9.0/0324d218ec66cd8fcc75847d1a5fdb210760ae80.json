{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"}]},{"source":"../session","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Session"}]},{"source":"meteor/markdown","imported":["Showdown"],"specifiers":[{"kind":"named","imported":"Showdown","local":"Showdown"}]},{"source":"meteor/react-meteor-data","imported":["withTracker"],"specifiers":[{"kind":"named","imported":"withTracker","local":"withTracker"}]},{"source":"react-dom","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"ReactDOM"}]},{"source":"meteor/templating","imported":["Template"],"specifiers":[{"kind":"named","imported":"Template","local":"Template"}]},{"source":"./Timeline","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Timeline"}]},{"source":"../models","imported":["Tellers","Subjects"],"specifiers":[{"kind":"named","imported":"Tellers","local":"Tellers"},{"kind":"named","imported":"Subjects","local":"Subjects"}]},{"source":"../css/style.css","imported":[],"specifiers":[]},{"source":"./Menu","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Menu"}]},{"source":"../helper","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Helper"}]},{"source":"react-redux","imported":["connect"],"specifiers":[{"kind":"named","imported":"connect","local":"connect"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/ui/Panel.js","filenameRelative":"imports/ui/Panel.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/ui/Panel.js.map","sourceFileName":"imports/ui/Panel.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"Panel"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    Component = void 0;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 0);\nvar Session = void 0;\nmodule.watch(require(\"../session\"), {\n  \"default\": function (v) {\n    Session = v;\n  }\n}, 1);\nvar Showdown = void 0;\nmodule.watch(require(\"meteor/markdown\"), {\n  Showdown: function (v) {\n    Showdown = v;\n  }\n}, 2);\nvar withTracker = void 0;\nmodule.watch(require(\"meteor/react-meteor-data\"), {\n  withTracker: function (v) {\n    withTracker = v;\n  }\n}, 3);\nvar ReactDOM = void 0;\nmodule.watch(require(\"react-dom\"), {\n  \"default\": function (v) {\n    ReactDOM = v;\n  }\n}, 4);\nvar Template = void 0;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 5);\nvar Timeline = void 0;\nmodule.watch(require(\"./Timeline\"), {\n  \"default\": function (v) {\n    Timeline = v;\n  }\n}, 6);\nvar Tellers = void 0,\n    Subjects = void 0;\nmodule.watch(require(\"../models\"), {\n  Tellers: function (v) {\n    Tellers = v;\n  },\n  Subjects: function (v) {\n    Subjects = v;\n  }\n}, 7);\nmodule.watch(require(\"../css/style.css\"));\nvar Menu = void 0;\nmodule.watch(require(\"./Menu\"), {\n  \"default\": function (v) {\n    Menu = v;\n  }\n}, 8);\nvar Helper = void 0;\nmodule.watch(require(\"../helper\"), {\n  \"default\": function (v) {\n    Helper = v;\n  }\n}, 9);\nvar connect = void 0;\nmodule.watch(require(\"react-redux\"), {\n  connect: function (v) {\n    connect = v;\n  }\n}, 10);\nvar Converter = new Showdown.converter();\n\nvar Panel = function (_Component) {\n  (0, _inherits3.default)(Panel, _Component);\n\n  function Panel(props) {\n    (0, _classCallCheck3.default)(this, Panel);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.state = {\n      new_story_content: '',\n      new_story_subjects: '',\n      subjects: [],\n      new_subject: ''\n    };\n    _this.update_subjects_timer;\n    _this.has_received_subjects = false;\n    _this.isLoggedIn = Helper.isLoggedIn(); // this.foo = new ReactiveVar( false );\n    // this.foo.set({'teste': true})\n\n    return _this;\n  }\n\n  Panel.prototype.componentDidUpdate = function () {\n    function componentDidUpdate() {\n      console.log('will update', this.props.teller);\n\n      if (this.props.subjects && !this.has_received_subjects) {\n        this.has_received_subjects = true;\n      } // alert(this.foo.get())\n\n    }\n\n    return componentDidUpdate;\n  }();\n\n  Panel.prototype.handleSubmitNewStory = function () {\n    function handleSubmitNewStory(e) {\n      var _this2 = this;\n\n      e.preventDefault(); // cria os objectos de subject\n\n      var subjects = this.createSubjectsFromString(this.state.new_story_subjects);\n      Meteor.call('panel.newStory', {\n        content: this.state.new_story_content,\n        subjects: subjects\n      }, function (err, data) {\n        if (!err) {\n          console.log('data', data);\n          ReactDOM.findDOMNode(_this2.refs['new-story-subjects']).value = '';\n          ReactDOM.findDOMNode(_this2.refs['new-story-content']).value = '';\n\n          _this2.setState({\n            new_story_content: ''\n          });\n        } else {\n          console.log('err', err);\n        }\n      });\n    }\n\n    return handleSubmitNewStory;\n  }();\n\n  Panel.prototype.createSubjectsFromString = function () {\n    function createSubjectsFromString(subjects_string) {\n      var subjects = subjects_string.split(',').map(function (subject) {\n        return {\n          name: subject.trim()\n        };\n      });\n      return subjects;\n    }\n\n    return createSubjectsFromString;\n  }();\n\n  Panel.prototype.handleSubmitNewSubject = function () {\n    function handleSubmitNewSubject(e) {\n      var _this3 = this;\n\n      e.preventDefault();\n      var subjects = this.props.subjects;\n      subjects = subjects.concat(this.createSubjectsFromString(this.state.new_subject));\n      Meteor.call('panel.updateSubjects', {\n        teller_id: this.props.teller._id,\n        subjects: subjects\n      }, function (err, data) {\n        if (!err) {\n          ReactDOM.findDOMNode(_this3.refs['new-subject']).value = '';\n        } else {\n          console.log('err', err);\n        }\n      });\n    }\n\n    return handleSubmitNewSubject;\n  }();\n\n  Panel.prototype.removeSubject = function () {\n    function removeSubject(_id) {\n      console.log('subjects ANTES remover', this.props.subjects);\n      var subjects = this.props.subjects;\n      subjects = subjects.filter(function (subject) {\n        return subject._id !== _id;\n      });\n      Meteor.call('panel.updateSubjects', {\n        teller_id: this.props.teller._id,\n        subjects: subjects\n      }, function (err, data) {\n        if (!err) {\n          console.log('subjects', data);\n        } else {\n          console.log('err', err);\n        }\n      });\n    }\n\n    return removeSubject;\n  }();\n\n  Panel.prototype.render = function () {\n    function render() {\n      var _this4 = this;\n\n      if (this.props.subjects) {\n        var subjects = this.props.subjects.map(function (subject, i) {\n          return React.createElement(\n            \"span\",\n            {\n              key: i\n            },\n            subject.name,\n            \" \",\n            React.createElement(\n              \"button\",\n              {\n                onClick: function () {\n                  _this4.removeSubject(subject._id);\n                }\n              },\n              \"Remover\"\n            )\n          );\n        });\n      } // if(this.props.teller){\n\n\n      return React.createElement(\n        \"div\",\n        {\n          className: \"container\"\n        },\n        React.createElement(Menu, null),\n        this.props.teller ? React.createElement(\n          \"div\",\n          null,\n          React.createElement(\n            \"div\",\n            null,\n            \"Seja bem vindo, \",\n            this.props.teller.email\n          ),\n          React.createElement(\n            \"div\",\n            null,\n            subjects\n          ),\n          React.createElement(\n            \"form\",\n            {\n              id: \"new-subject-form\",\n              onSubmit: this.handleSubmitNewSubject.bind(this)\n            },\n            React.createElement(\"input\", {\n              id: \"new-subject\",\n              ref: \"new-subject\",\n              onChange: function (e) {\n                _this4.setState({\n                  new_subject: e.target.value\n                });\n              }\n            })\n          ),\n          React.createElement(\n            \"form\",\n            {\n              className: \"new-story-form\",\n              onSubmit: this.handleSubmitNewStory.bind(this)\n            },\n            React.createElement(\"div\", {\n              id: \"new-story-preview\",\n              dangerouslySetInnerHTML: {\n                __html: Converter.makeHtml(this.state.new_story_content)\n              }\n            }),\n            React.createElement(\"textarea\", {\n              id: \"markdown-text\",\n              ref: \"new-story-content\",\n              onChange: function (e) {\n                _this4.setState({\n                  new_story_content: e.target.value\n                });\n              },\n              defaultValue: this.state.new_story_content\n            }),\n            React.createElement(\"input\", {\n              id: \"new-story-subjects\",\n              ref: \"new-story-subjects\",\n              defaultValue: this.state.new_story_subjects,\n              onChange: function (e) {\n                _this4.setState({\n                  new_story_subjects: e.target.value\n                });\n              }\n            }),\n            React.createElement(\n              \"button\",\n              null,\n              \"Send\"\n            )\n          ),\n          React.createElement(Timeline, {\n            subjects: this.props.teller.subjects\n          })\n        ) : null\n      ); // }else this.props.history.push('/panel');\n    }\n\n    return render;\n  }();\n\n  return Panel;\n}(Component);\n\nvar trackedComponent = withTracker(function (props) {\n  console.log('props', props);\n  var teller = Tellers.findOne({\n    _id: Session.get('teller_id')\n  });\n  return {\n    teller: teller,\n    subjects: teller ? Subjects.find({\n      _id: {\n        $in: teller.subjects\n      }\n    }).fetch() : []\n  };\n})(Panel);\nvar connectedComponent = connect(function (state) {\n  console.log('state', state);\n  return state;\n})(trackedComponent);\nmodule.exportDefault(connectedComponent);","map":{"version":3,"sources":["imports/ui/Panel.js"],"names":["React","Component","module","watch","require","v","Session","Showdown","withTracker","ReactDOM","Template","Timeline","Tellers","Subjects","Menu","Helper","connect","Converter","converter","Panel","props","state","new_story_content","new_story_subjects","subjects","new_subject","update_subjects_timer","has_received_subjects","isLoggedIn","componentDidUpdate","console","log","teller","handleSubmitNewStory","e","preventDefault","createSubjectsFromString","Meteor","call","content","err","data","findDOMNode","refs","value","setState","subjects_string","split","map","subject","name","trim","handleSubmitNewSubject","concat","teller_id","_id","removeSubject","filter","render","i","email","bind","target","__html","makeHtml","trackedComponent","findOne","get","find","$in","fetch","connectedComponent","exportDefault"],"mappings":";;;;;;;;;;;;;;AAAA,IAAIA,cAAJ;AAAA,IAAUC,kBAAV;AAAoBC,OAAOC,KAAP,CAAaC,QAAQ,OAAR,CAAb,EAA8B;AAAA,uBAASC,CAAT,EAAW;AAACL,YAAMK,CAAN;AAAQ,GAApB;AAAqBJ,WAArB,YAA+BI,CAA/B,EAAiC;AAACJ,gBAAUI,CAAV;AAAY;AAA9C,CAA9B,EAA8E,CAA9E;AAAiF,IAAIC,gBAAJ;AAAYJ,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAAA,uBAASC,CAAT,EAAW;AAACC,cAAQD,CAAR;AAAU;AAAtB,CAAnC,EAA2D,CAA3D;AAA8D,IAAIE,iBAAJ;AAAaL,OAAOC,KAAP,CAAaC,QAAQ,iBAAR,CAAb,EAAwC;AAACG,UAAD,YAAUF,CAAV,EAAY;AAACE,eAASF,CAAT;AAAW;AAAxB,CAAxC,EAAkE,CAAlE;AAAqE,IAAIG,oBAAJ;AAAgBN,OAAOC,KAAP,CAAaC,QAAQ,0BAAR,CAAb,EAAiD;AAACI,aAAD,YAAaH,CAAb,EAAe;AAACG,kBAAYH,CAAZ;AAAc;AAA9B,CAAjD,EAAiF,CAAjF;AAAoF,IAAII,iBAAJ;AAAaP,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAAA,uBAASC,CAAT,EAAW;AAACI,eAASJ,CAAT;AAAW;AAAvB,CAAlC,EAA2D,CAA3D;AAA8D,IAAIK,iBAAJ;AAAaR,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACM,UAAD,YAAUL,CAAV,EAAY;AAACK,eAASL,CAAT;AAAW;AAAxB,CAA1C,EAAoE,CAApE;AAAuE,IAAIM,iBAAJ;AAAaT,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAAA,uBAASC,CAAT,EAAW;AAACM,eAASN,CAAT;AAAW;AAAvB,CAAnC,EAA4D,CAA5D;AAA+D,IAAIO,gBAAJ;AAAA,IAAYC,iBAAZ;AAAqBX,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAACQ,SAAD,YAASP,CAAT,EAAW;AAACO,cAAQP,CAAR;AAAU,GAAtB;AAAuBQ,UAAvB,YAAgCR,CAAhC,EAAkC;AAACQ,eAASR,CAAT;AAAW;AAA9C,CAAlC,EAAkF,CAAlF;AAAqFH,OAAOC,KAAP,CAAaC,QAAQ,kBAAR,CAAb;AAA0C,IAAIU,aAAJ;AAASZ,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAAA,uBAASC,CAAT,EAAW;AAACS,WAAKT,CAAL;AAAO;AAAnB,CAA/B,EAAoD,CAApD;AAAuD,IAAIU,eAAJ;AAAWb,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAAA,uBAASC,CAAT,EAAW;AAACU,aAAOV,CAAP;AAAS;AAArB,CAAlC,EAAyD,CAAzD;AAA4D,IAAIW,gBAAJ;AAAYd,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAACY,SAAD,YAASX,CAAT,EAAW;AAACW,cAAQX,CAAR;AAAU;AAAtB,CAApC,EAA4D,EAA5D;AAgBv3B,IAAMY,YAAY,IAAIV,SAASW,SAAb,EAAlB;;IAEMC,K;;;AACJ,iBAAYC,KAAZ,EAAkB;AAAA;;AAAA,+DAChB,sBAAMA,KAAN,CADgB;;AAEhB,UAAKC,KAAL,GAAa;AACXC,yBAAmB,EADR;AAEXC,0BAAoB,EAFT;AAGXC,gBAAU,EAHC;AAIXC,mBAAa;AAJF,KAAb;AAOA,UAAKC,qBAAL;AACA,UAAKC,qBAAL,GAA6B,KAA7B;AACA,UAAKC,UAAL,GAAkBb,OAAOa,UAAP,EAAlB,CAXgB,CAahB;AACA;;AAdgB;AAejB;;kBAEDC,kB;kCAAoB;AAElBC,cAAQC,GAAR,CAAY,aAAZ,EAA2B,KAAKX,KAAL,CAAWY,MAAtC;;AACA,UAAG,KAAKZ,KAAL,CAAWI,QAAX,IAAuB,CAAC,KAAKG,qBAAhC,EAAsD;AACpD,aAAKA,qBAAL,GAA6B,IAA7B;AACD,OALiB,CAOlB;;AACD;;;;;kBAEDM,oB;kCAAqBC,C,EAAE;AAAA;;AACrBA,QAAEC,cAAF,GADqB,CAGrB;;AAEA,UAAIX,WAAW,KAAKY,wBAAL,CAA8B,KAAKf,KAAL,CAAWE,kBAAzC,CAAf;AAEAc,aAAOC,IAAP,CAAY,gBAAZ,EAA8B;AAACC,iBAAS,KAAKlB,KAAL,CAAWC,iBAArB;AAAwCE,kBAAUA;AAAlD,OAA9B,EAA2F,UAACgB,GAAD,EAAMC,IAAN,EAAa;AACtG,YAAG,CAACD,GAAJ,EAAQ;AACNV,kBAAQC,GAAR,CAAY,MAAZ,EAAoBU,IAApB;AACAhC,mBAASiC,WAAT,CAAqB,OAAKC,IAAL,CAAU,oBAAV,CAArB,EAAsDC,KAAtD,GAA8D,EAA9D;AACAnC,mBAASiC,WAAT,CAAqB,OAAKC,IAAL,CAAU,mBAAV,CAArB,EAAqDC,KAArD,GAA6D,EAA7D;;AACA,iBAAKC,QAAL,CAAc;AAACvB,+BAAmB;AAApB,WAAd;AACD,SALD,MAKK;AACHQ,kBAAQC,GAAR,CAAY,KAAZ,EAAmBS,GAAnB;AACD;AACF,OATD;AAUD;;;;;kBAEDJ,wB;sCAAyBU,e,EAAgB;AACvC,UAAItB,WAAWsB,gBAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,GAA3B,CAA+B,UAACC,OAAD,EAAW;AACvD,eAAO;AACLC,gBAAMD,QAAQE,IAAR;AADD,SAAP;AAGD,OAJc,CAAf;AAMA,aAAO3B,QAAP;AACD;;;;;kBAED4B,sB;oCAAuBlB,C,EAAE;AAAA;;AACvBA,QAAEC,cAAF;AACA,UAAIX,WAAW,KAAKJ,KAAL,CAAWI,QAA1B;AACAA,iBAAWA,SAAS6B,MAAT,CAAgB,KAAKjB,wBAAL,CAA8B,KAAKf,KAAL,CAAWI,WAAzC,CAAhB,CAAX;AACAY,aAAOC,IAAP,CAAY,sBAAZ,EAAoC;AAACgB,mBAAW,KAAKlC,KAAL,CAAWY,MAAX,CAAkBuB,GAA9B;AAAmC/B,kBAAUA;AAA7C,OAApC,EAA4F,UAACgB,GAAD,EAAMC,IAAN,EAAa;AACvG,YAAG,CAACD,GAAJ,EAAQ;AACN/B,mBAASiC,WAAT,CAAqB,OAAKC,IAAL,CAAU,aAAV,CAArB,EAA+CC,KAA/C,GAAuD,EAAvD;AACD,SAFD,MAEK;AACHd,kBAAQC,GAAR,CAAY,KAAZ,EAAmBS,GAAnB;AACD;AACF,OAND;AAOD;;;;;kBAEDgB,a;2BAAcD,G,EAAI;AAChBzB,cAAQC,GAAR,CAAY,wBAAZ,EAAuC,KAAKX,KAAL,CAAWI,QAAlD;AACA,UAAIA,WAAW,KAAKJ,KAAL,CAAWI,QAA1B;AACAA,iBAAWA,SAASiC,MAAT,CAAgB,UAACR,OAAD,EAAW;AACpC,eAAOA,QAAQM,GAAR,KAAgBA,GAAvB;AACD,OAFU,CAAX;AAIAlB,aAAOC,IAAP,CAAY,sBAAZ,EAAoC;AAACgB,mBAAW,KAAKlC,KAAL,CAAWY,MAAX,CAAkBuB,GAA9B;AAAmC/B,kBAAUA;AAA7C,OAApC,EAA4F,UAACgB,GAAD,EAAMC,IAAN,EAAa;AACvG,YAAG,CAACD,GAAJ,EAAQ;AACNV,kBAAQC,GAAR,CAAY,UAAZ,EAAwBU,IAAxB;AACD,SAFD,MAEK;AACHX,kBAAQC,GAAR,CAAY,KAAZ,EAAmBS,GAAnB;AACD;AACF,OAND;AAOD;;;;;kBAEDkB,M;sBAAS;AAAA;;AACP,UAAG,KAAKtC,KAAL,CAAWI,QAAd,EAAuB;AACrB,YAAIA,WAAW,KAAKJ,KAAL,CAAWI,QAAX,CAAoBwB,GAApB,CAAwB,UAACC,OAAD,EAAUU,CAAV,EAAc;AACnD,iBACE;AAAA;AAAA;AAAM,mBAAKA;AAAX;AAAeV,oBAAQC,IAAvB;AAAA;AAA6B;AAAA;AAAA;AAAQ,yBAAS,YAAI;AAChD,yBAAKM,aAAL,CAAmBP,QAAQM,GAA3B;AACD;AAF4B;AAAA;AAAA;AAA7B,WADF;AAKD,SANc,CAAf;AAOD,OATM,CAUP;;;AACA,aACE;AAAA;AAAA;AAAK,qBAAU;AAAf;AACE,4BAAC,IAAD,OADF;AAGG,aAAKnC,KAAL,CAAWY,MAAZ,GACE;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAsB,iBAAKZ,KAAL,CAAWY,MAAX,CAAkB4B;AAAxC,WADA;AAGA;AAAA;AAAA;AACEpC;AADF,WAHA;AAOA;AAAA;AAAA;AAAM,kBAAG,kBAAT;AAA4B,wBAAU,KAAK4B,sBAAL,CAA4BS,IAA5B,CAAiC,IAAjC;AAAtC;AACA;AAAO,kBAAG,aAAV;AAAwB,mBAAI,aAA5B;AACA,wBAAU,UAAC3B,CAAD,EAAK;AACb,uBAAKW,QAAL,CAAc;AAACpB,+BAAaS,EAAE4B,MAAF,CAASlB;AAAvB,iBAAd;AACD;AAHD;AADA,WAPA;AAeA;AAAA;AAAA;AAAM,yBAAU,gBAAhB;AAAiC,wBAAU,KAAKX,oBAAL,CAA0B4B,IAA1B,CAA+B,IAA/B;AAA3C;AACA;AAAK,kBAAG,mBAAR;AAA4B,uCAAyB;AAACE,wBAAQ9C,UAAU+C,QAAV,CAAmB,KAAK3C,KAAL,CAAWC,iBAA9B;AAAT;AAArD,cADA;AAGA;AAAU,kBAAG,eAAb;AAA6B,mBAAI,mBAAjC;AACA,wBAAU,UAACY,CAAD,EAAK;AACb,uBAAKW,QAAL,CAAc;AAACvB,qCAAmBY,EAAE4B,MAAF,CAASlB;AAA7B,iBAAd;AACD,eAHD;AAIA,4BAAc,KAAKvB,KAAL,CAAWC;AAJzB,cAHA;AAUA;AAAO,kBAAG,oBAAV;AAA+B,mBAAI,oBAAnC;AACA,4BAAc,KAAKD,KAAL,CAAWE,kBADzB;AAEA,wBAAU,UAACW,CAAD,EAAK;AACb,uBAAKW,QAAL,CAAc;AAACtB,sCAAoBW,EAAE4B,MAAF,CAASlB;AAA9B,iBAAd;AACD;AAJD,cAVA;AAiBA;AAAA;AAAA;AAAA;AAAA;AAjBA,WAfA;AAmCA,8BAAC,QAAD;AAAU,sBAAU,KAAKxB,KAAL,CAAWY,MAAX,CAAkBR;AAAtC;AAnCA,SADF,GAsCI;AAzCN,OADF,CAXO,CAyDP;AACD;;;;;;EAhJiBvB,S;;AAmJpB,IAAIgE,mBAAmBzD,YAAY,UAACY,KAAD,EAAU;AAC3CU,UAAQC,GAAR,CAAY,OAAZ,EAAqBX,KAArB;AACA,MAAIY,SAASpB,QAAQsD,OAAR,CAAgB;AAACX,SAAKjD,QAAQ6D,GAAR,CAAY,WAAZ;AAAN,GAAhB,CAAb;AACA,SAAO;AACLnC,YAAQA,MADH;AAELR,cAAUQ,SAASnB,SAASuD,IAAT,CAAc;AAACb,WAAK;AAACc,aAAKrC,OAAOR;AAAb;AAAN,KAAd,EAA6C8C,KAA7C,EAAT,GAAgE;AAFrE,GAAP;AAID,CAPsB,EAOpBnD,KAPoB,CAAvB;AASA,IAAIoD,qBAAqBvD,QAAQ,UAASK,KAAT,EAAe;AAC9CS,UAAQC,GAAR,CAAY,OAAZ,EAAqBV,KAArB;AACA,SAAOA,KAAP;AACD,CAHwB,EAGtB4C,gBAHsB,CAAzB;AA9KA/D,OAAOsE,aAAP,CAmLeD,kBAnLf","file":"imports/ui/Panel.js.map","sourcesContent":["import React, { Component } from 'react';\n// import { Session } from 'meteor/session';\nimport Session from '../session';\nimport { Showdown } from 'meteor/markdown';\nimport { withTracker } from 'meteor/react-meteor-data';\nimport ReactDOM from 'react-dom'\nimport { Template } from 'meteor/templating';\n\nimport Timeline from './Timeline';\nimport { Tellers, Subjects } from '../models';\nimport '../css/style.css';\nimport Menu from './Menu'\nimport Helper from '../helper'\n\nimport { connect } from 'react-redux'\n\nconst Converter = new Showdown.converter();\n\nclass Panel extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      new_story_content: '',\n      new_story_subjects: '',\n      subjects: [],\n      new_subject: ''\n    };\n\n    this.update_subjects_timer;\n    this.has_received_subjects = false;\n    this.isLoggedIn = Helper.isLoggedIn();\n\n    // this.foo = new ReactiveVar( false );\n    // this.foo.set({'teste': true})\n  }\n\n  componentDidUpdate(){\n\n    console.log('will update', this.props.teller);\n    if(this.props.subjects && !this.has_received_subjects){\n      this.has_received_subjects = true;\n    }\n\n    // alert(this.foo.get())\n  }\n\n  handleSubmitNewStory(e){\n    e.preventDefault();\n\n    // cria os objectos de subject\n\n    var subjects = this.createSubjectsFromString(this.state.new_story_subjects);\n\n    Meteor.call('panel.newStory', {content: this.state.new_story_content, subjects: subjects}, (err, data)=>{\n      if(!err){\n        console.log('data', data)\n        ReactDOM.findDOMNode(this.refs['new-story-subjects']).value = '';\n        ReactDOM.findDOMNode(this.refs['new-story-content']).value = '';\n        this.setState({new_story_content: ''})\n      }else{\n        console.log('err', err)\n      }\n    });\n  }\n\n  createSubjectsFromString(subjects_string){\n    var subjects = subjects_string.split(',').map((subject)=>{\n      return {\n        name: subject.trim()\n      };\n    });\n\n    return subjects;\n  }\n\n  handleSubmitNewSubject(e){\n    e.preventDefault();\n    var subjects = this.props.subjects;\n    subjects = subjects.concat(this.createSubjectsFromString(this.state.new_subject));\n    Meteor.call('panel.updateSubjects', {teller_id: this.props.teller._id, subjects: subjects}, (err, data)=>{\n      if(!err){\n        ReactDOM.findDOMNode(this.refs['new-subject']).value = '';\n      }else{\n        console.log('err', err)\n      }\n    });\n  }\n\n  removeSubject(_id){\n    console.log('subjects ANTES remover',  this.props.subjects)\n    var subjects = this.props.subjects;\n    subjects = subjects.filter((subject)=>{\n      return subject._id !== _id;\n    });\n\n    Meteor.call('panel.updateSubjects', {teller_id: this.props.teller._id, subjects: subjects}, (err, data)=>{\n      if(!err){\n        console.log('subjects', data)\n      }else{\n        console.log('err', err)\n      }\n    });\n  }\n\n  render() {\n    if(this.props.subjects){\n      var subjects = this.props.subjects.map((subject, i)=>{\n        return (\n          <span key={i}>{subject.name} <button onClick={()=>{\n            this.removeSubject(subject._id)\n          }}>Remover</button></span>\n        )\n      })\n    }\n    // if(this.props.teller){\n    return (\n      <div className=\"container\">\n        <Menu />\n      {\n        (this.props.teller) ? (\n          <div>\n          <div>Seja bem vindo, {this.props.teller.email}</div>\n\n          <div>\n          { subjects }\n          </div>\n\n          <form id=\"new-subject-form\" onSubmit={this.handleSubmitNewSubject.bind(this)}>\n          <input id=\"new-subject\" ref=\"new-subject\"\n          onChange={(e)=>{\n            this.setState({new_subject: e.target.value});\n          }}\n          />\n          </form>\n\n          <form className='new-story-form' onSubmit={this.handleSubmitNewStory.bind(this)}>\n          <div id='new-story-preview' dangerouslySetInnerHTML={{__html: Converter.makeHtml(this.state.new_story_content)}} />\n\n          <textarea id='markdown-text' ref=\"new-story-content\"\n          onChange={(e)=>{\n            this.setState({new_story_content: e.target.value})\n          }}\n          defaultValue={this.state.new_story_content}>\n          </textarea>\n\n          <input id=\"new-story-subjects\" ref=\"new-story-subjects\"\n          defaultValue={this.state.new_story_subjects}\n          onChange={(e)=>{\n            this.setState({new_story_subjects: e.target.value})\n          }}\n          />\n\n          <button>Send</button>\n          </form>\n\n          <Timeline subjects={this.props.teller.subjects} />\n          </div>\n        ) : null\n      }\n      </div>\n    );\n    // }else this.props.history.push('/panel');\n  }\n}\n\nvar trackedComponent = withTracker((props) =>{\n  console.log('props', props)\n  var teller = Tellers.findOne({_id: Session.get('teller_id')});\n  return {\n    teller: teller,\n    subjects: teller ? Subjects.find({_id: {$in: teller.subjects}}).fetch() : []\n  }\n})(Panel);\n\nvar connectedComponent = connect(function(state){\n  console.log('state', state)\n  return state;\n})(trackedComponent);\n\nexport default connectedComponent;\n"]},"hash":"0324d218ec66cd8fcc75847d1a5fdb210760ae80"}
