{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"}]},{"source":"meteor/session","imported":["Session"],"specifiers":[{"kind":"named","imported":"Session","local":"Session"}]},{"source":"meteor/markdown","imported":["Showdown"],"specifiers":[{"kind":"named","imported":"Showdown","local":"Showdown"}]},{"source":"meteor/react-meteor-data","imported":["withTracker"],"specifiers":[{"kind":"named","imported":"withTracker","local":"withTracker"}]},{"source":"../models","imported":["Stories"],"specifiers":[{"kind":"named","imported":"Stories","local":"Stories"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/ui/Timeline.js","filenameRelative":"imports/ui/Timeline.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/ui/Timeline.js.map","sourceFileName":"imports/ui/Timeline.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"Timeline"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    Component = void 0;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 0);\nvar Session = void 0;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 1);\nvar Showdown = void 0;\nmodule.watch(require(\"meteor/markdown\"), {\n  Showdown: function (v) {\n    Showdown = v;\n  }\n}, 2);\nvar withTracker = void 0;\nmodule.watch(require(\"meteor/react-meteor-data\"), {\n  withTracker: function (v) {\n    withTracker = v;\n  }\n}, 3);\nvar Stories = void 0;\nmodule.watch(require(\"../models\"), {\n  Stories: function (v) {\n    Stories = v;\n  }\n}, 4);\nvar Converter = new Showdown.converter();\n\nvar Timeline = function (_Component) {\n  (0, _inherits3.default)(Timeline, _Component);\n\n  function Timeline(props) {\n    (0, _classCallCheck3.default)(this, Timeline);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.state = {\n      loading: false,\n      story_ids: [],\n      stories: []\n    };\n\n    _this.setPageScrollListener();\n\n    return _this;\n  }\n\n  Timeline.prototype.componentDidMount = function () {\n    function componentDidMount() {\n      this.getStories();\n    }\n\n    return componentDidMount;\n  }();\n\n  Timeline.prototype.setPageScrollListener = function () {\n    function setPageScrollListener() {\n      var _this2 = this;\n\n      window.onscroll = function () {\n        var d = document.documentElement;\n        var offset = d.scrollTop + window.innerHeight;\n        var height = d.offsetHeight;\n        var padding = 10;\n\n        if (offset >= height - padding) {\n          // Get more stories\n          _this2.getStories();\n        }\n      };\n    }\n\n    return setPageScrollListener;\n  }();\n\n  Timeline.prototype.getStories = function () {\n    function getStories() {\n      var _this3 = this;\n\n      if (!this.state.loading) {\n        this.setState({\n          loading: true\n        });\n        Meteor.call('timeline.getStories', {\n          subjects: this.props.subjects,\n          story_ids: this.state.story_ids\n        }, function (err, data) {\n          if (!err) {\n            var story_ids = _this3.state.story_ids;\n            data.forEach(function (story) {\n              story_ids.push(story._id);\n            });\n\n            var stories = _this3.state.stories.concat(data);\n\n            _this3.setState({\n              loading: false,\n              story_ids: story_ids,\n              stories: stories\n            });\n          } else {\n            _this3.setState({\n              loading: false\n            });\n          }\n        });\n      }\n    }\n\n    return getStories;\n  }();\n\n  Timeline.prototype.render = function () {\n    function render() {\n      var stories = this.state.stories.map(function (story) {\n        return React.createElement(\n          \"div\",\n          {\n            key: story._id,\n            className: \"story\"\n          },\n          React.createElement(\"div\", {\n            id: \"content\",\n            dangerouslySetInnerHTML: {\n              __html: Converter.makeHtml(story.content)\n            }\n          })\n        );\n      });\n      return React.createElement(\n        \"div\",\n        {\n          className: \"container\"\n        },\n        stories\n      );\n    }\n\n    return render;\n  }();\n\n  return Timeline;\n}(Component);\n\nmodule.exportDefault(withTracker(function (_ref) {\n  var subjects = _ref.subjects;\n  return {}; // A outra prossibilidade seria modificar variáveis dentro deste módulo\n  // para as variáveis reativas, por exemplo, de stories,\n  // fizesse as buscas\n  // mas o minimongo não permitiria em produção\n  // var stories_from_subjects = Stories.find({subjects: {$in: subjects}}).fetch();\n  // var ids = stories_from_subjects.map((story)=>{\n  //   return story._id;\n  // });\n  //\n  // var more_stories = Stories.find({_id: {$nin: ids}}).fetch();\n  //\n  // return {\n  //   stories: stories_from_subjects.concat(more_stories)\n  // }\n})(Timeline));","map":{"version":3,"sources":["imports/ui/Timeline.js"],"names":["React","Component","module","watch","require","v","Session","Showdown","withTracker","Stories","Converter","converter","Timeline","props","state","loading","story_ids","stories","setPageScrollListener","componentDidMount","getStories","window","onscroll","d","document","documentElement","offset","scrollTop","innerHeight","height","offsetHeight","padding","setState","Meteor","call","subjects","err","data","forEach","story","push","_id","concat","render","map","__html","makeHtml","content","exportDefault"],"mappings":"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","file":"imports/ui/Timeline.js.map","sourcesContent":["import React, { Component } from 'react';\nimport { Session } from 'meteor/session';\nimport { Showdown } from 'meteor/markdown';\nimport { withTracker } from 'meteor/react-meteor-data';\n\nimport { Stories } from '../models';\n\nconst Converter = new Showdown.converter();\n\nclass Timeline extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      loading: false,\n      story_ids: [],\n      stories: []\n    };\n\n    this.setPageScrollListener();\n  }\n\n  componentDidMount(){\n    this.getStories();\n  }\n\n  setPageScrollListener(){\n    window.onscroll = ()=>{\n      var d = document.documentElement;\n      var offset = d.scrollTop + window.innerHeight;\n      var height = d.offsetHeight;\n      var padding = 10;\n\n      if (offset >= height-padding) {\n        // Get more stories\n        this.getStories();\n      }\n    };\n  }\n\n  getStories(){\n    if(!this.state.loading){\n      this.setState({loading: true});\n      Meteor.call('timeline.getStories', {subjects: this.props.subjects, story_ids: this.state.story_ids}, (err, data)=>{\n        if(!err){\n          var story_ids = this.state.story_ids;\n          data.forEach((story)=>{\n            story_ids.push(story._id);\n          });\n\n          var stories = this.state.stories.concat(data);\n\n          this.setState({loading: false, story_ids, stories});\n        }else{\n          this.setState({loading: false});\n        }\n      });\n    }\n  }\n\n  render() {\n    var stories = this.state.stories.map( (story)=>{\n      return (\n        <div key={story._id} className='story'>\n        <div id='content' dangerouslySetInnerHTML={{__html: Converter.makeHtml(story.content)}} />\n        </div>\n      );\n    } );\n\n    return (\n      <div className=\"container\">\n      { stories }\n      </div>\n    )\n  }\n}\n\nexport default withTracker(({subjects}) =>{\n  return {};\n\n  // A outra prossibilidade seria modificar variáveis dentro deste módulo\n  // para as variáveis reativas, por exemplo, de stories,\n  // fizesse as buscas\n  // mas o minimongo não permitiria em produção\n\n  // var stories_from_subjects = Stories.find({subjects: {$in: subjects}}).fetch();\n  // var ids = stories_from_subjects.map((story)=>{\n  //   return story._id;\n  // });\n  //\n  // var more_stories = Stories.find({_id: {$nin: ids}}).fetch();\n  //\n  // return {\n  //   stories: stories_from_subjects.concat(more_stories)\n  // }\n})(Timeline);\n"]},"hash":"2e143582ac2a49145648a41c80e61ee21a48ea8b"}
